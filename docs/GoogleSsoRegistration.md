# Google Authentication Registration

In order to allow users to log into the Personal Data Server web application
using their Google account, the Personal Data Server must to registered with
Google.  The result of the registration process is that Google generates a
client id and secret for the Personal Data Server to use for its single
sign-on workflow.  The following provides information regarding the Google
registration process.

Note that this outlines what is required for a test server under development.
The steps for registering a production server are similar but with some
differences; and involve additional steps such as submitting an application to
Google for [verification](https://support.google.com/cloud/answer/9110914).
Where applicable, the instructions use the phrase "for development" to highlight
the difference.

1. Create or select a Project in the [Google Cloud Console](https://console.cloud.google.com).
2. Configure authentication consent using the "OAuth Consent Screen" page in the
   "APIs and Services" section of the Console.
3. For development, for "User Type", choose "External".  Submitting the form
   will start an "Edit app registration" step-by-step process for configuring
   the "OAuth consent screen".  At step one:
    * For development, fill in the "App information" with something
      meaningful to you and other developers.
    * For development, under "App Domain", use a local host url with http
      for the "Application home page". The port is up to the developer.  An
      example is `http://localhost:3000`.
    * For development, under "Application privacy policy link", use the
      proposed privacy policy at the root of the project: `http://localhost:3000/PRIVACY_POLICY.md`.
      This file is located in the source code root directory.
    * For development, Under "Application terms of service link", use the
      dummy service agreement at the root of the project: `http://localhost:3000/TERMS_OF_SERVICE.md`,
      also located in the root folder of the source.
    * For development, leave "Authorized domains" blank.  This is needed in a
      production scenario and only after Google has authorized the access to
      their users by the Personal Data Server.
    * For development, enter your email address in the "Developer contact
      information" field.
4. Required scopes (step 2 of the "Edit app registration"):
    * `auth/userinfo.email`
    * `auth/userinfo.profile`
5. Test users (step 3 of the "Edit app registration"):
    * Enter at least one email that is your Google account.  That is, an email
      that can be used to log into Google at [`https://accounts.google.com`](https://accounts.google.com).
    * Note that this entire setup can be done by one developer who is then
      responsible for adding Google accounts (test users) for all other
      developers.  In that case each developer uses the same client id and
      secret generated by this process, and the same URIs set at step 3 above
      and step 8 below.  Alternatively, each developer can generate their own
      client id and secret, but add only themself as a test user.
6. Save this consent screen configuration.  A summary page is shown.
7. Next, create an "OAuth client ID" using the "Credentials" link, which is
   also in the "APIs and Services" section on the left of the Console.
8. Click the "+ CREATE CREDENTIAL" menu button near the top of the page,
   slightly left of centre and choose "OAuth client ID".
     * Application type is "Web application".
     * For development, the "Name" can be set to anything meaningful.
     * Authorized JavaScript origins should be the URI set at step 3. above,
       e.g., `http://localhost:3000`.
     * Authorized redirect URIs should list the URI for Google SSO, based
       on the URI set at step 3. The end point is
       `/sso/google/login/callback`.  If you used `http://localhost:3000`
       at step 3, then the full authorized redirect URI is:
       * `http://localhost:3000/sso/google/login/callback`.
     * Click the "Create" button.
     * When created, take note of the Client ID and Client Secret.

This completes the Google registration process.

## References
* Google's [Setting up OAuth 2.0](https://support.google.com/googleapi/answer/6158849?hl=en)
* Clusive's [Connecting Google Authentication](https://github.com/cast-org/clusive/blob/development/INSTALL.md#connecting-google-authentication)
